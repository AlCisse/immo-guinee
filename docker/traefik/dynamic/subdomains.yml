# ===============================================
# Subdomains Configuration - immoguinee.com
# Routes for admin tools: n8n, waha, grafana, minio, pgadmin
# Docker Swarm service names use immog_ prefix
# SECURED: All admin UIs require BasicAuth (admin-auth middleware)
# ===============================================

http:
  routers:
    # n8n (Workflow Automation) - automate.immoguinee.com
    # SECURED with admin-auth middleware
    n8n-secure:
      rule: "Host(`automate.immoguinee.com`)"
      entryPoints:
        - websecure
      service: n8n
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    n8n-http:
      rule: "Host(`automate.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: n8n
      priority: 1

    # WAHA (WhatsApp API) - waha.immoguinee.com
    # SECURED with admin-auth middleware
    waha-secure:
      rule: "Host(`waha.immoguinee.com`)"
      entryPoints:
        - websecure
      service: waha
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    waha-http:
      rule: "Host(`waha.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: waha
      priority: 1

    # Grafana (Monitoring) - monitoring.immoguinee.com
    # SECURED with admin-auth middleware
    grafana-secure:
      rule: "Host(`monitoring.immoguinee.com`)"
      entryPoints:
        - websecure
      service: grafana
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    grafana-http:
      rule: "Host(`monitoring.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: grafana
      priority: 1

    # MinIO Console - minio.immoguinee.com
    # SECURED with admin-auth middleware
    minio-secure:
      rule: "Host(`minio.immoguinee.com`)"
      entryPoints:
        - websecure
      service: minio-console
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    minio-http:
      rule: "Host(`minio.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: minio-console
      priority: 1

    # pgAdmin (Database Admin) - pgadmin.immoguinee.com
    # SECURED with admin-auth middleware
    pgadmin-secure:
      rule: "Host(`pgadmin.immoguinee.com`)"
      entryPoints:
        - websecure
      service: pgadmin
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    pgadmin-http:
      rule: "Host(`pgadmin.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: pgadmin
      priority: 1

    # Traefik Dashboard - traefik.immoguinee.com
    # SECURED with admin-auth middleware
    # Uses api@internal service (built-in Traefik dashboard)
    traefik-secure:
      rule: "Host(`traefik.immoguinee.com`)"
      entryPoints:
        - websecure
      service: api@internal
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    traefik-http:
      rule: "Host(`traefik.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: api@internal
      priority: 1

    # Prometheus - prometheus.immoguinee.com
    # SECURED with admin-auth middleware
    prometheus-secure:
      rule: "Host(`prometheus.immoguinee.com`)"
      entryPoints:
        - websecure
      service: prometheus
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    prometheus-http:
      rule: "Host(`prometheus.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: prometheus
      priority: 1

    # Alertmanager - alertmanager.immoguinee.com
    # SECURED with admin-auth middleware
    alertmanager-secure:
      rule: "Host(`alertmanager.immoguinee.com`)"
      entryPoints:
        - websecure
      service: alertmanager
      tls: {}
      middlewares:
        - admin-auth@file
      priority: 100

    alertmanager-http:
      rule: "Host(`alertmanager.immoguinee.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: alertmanager
      priority: 1

  services:
    # All services use Docker Swarm naming: immog_<service>
    n8n:
      loadBalancer:
        servers:
          - url: "http://immog_n8n:5678"

    waha:
      loadBalancer:
        servers:
          - url: "http://immog_waha:3000"

    grafana:
      loadBalancer:
        servers:
          - url: "http://immog_grafana:3000"

    minio-console:
      loadBalancer:
        servers:
          - url: "http://immog_minio:9001"

    pgadmin:
      loadBalancer:
        servers:
          - url: "http://immog_pgadmin:80"

    prometheus:
      loadBalancer:
        servers:
          - url: "http://immog_prometheus:9090"

    alertmanager:
      loadBalancer:
        servers:
          - url: "http://immog_alertmanager:9093"

    # Note: traefik-dashboard removed - using api@internal instead

  middlewares:
    https-redirect:
      redirectScheme:
        scheme: https
        permanent: true

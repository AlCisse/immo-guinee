global:
  # SMTP configuration (configure for email notifications)
  # smtp_smarthost: 'smtp.gmail.com:587'
  # smtp_from: 'alerts@immoguinee.com'
  # smtp_auth_username: 'alerts@immoguinee.com'
  # smtp_auth_password: 'your-app-password'

  # Webhook timeout
  http_config:
    follow_redirects: true

  # Default resolve timeout
  resolve_timeout: 5m

# Route tree
route:
  # Default receiver
  receiver: 'default-receiver'

  # Group alerts by these labels
  group_by: ['alertname', 'severity', 'job']

  # Wait before sending first notification
  group_wait: 30s

  # Wait before sending updated notification
  group_interval: 5m

  # Wait before resending notification
  repeat_interval: 4h

  # Child routes for different severities
  routes:
    # Critical alerts - immediate notification
    - match:
        severity: critical
      receiver: 'critical-receiver'
      group_wait: 10s
      repeat_interval: 1h
      continue: true

    # Warning alerts - less urgent
    - match:
        severity: warning
      receiver: 'warning-receiver'
      group_wait: 1m
      repeat_interval: 4h

# Receivers
receivers:
  # Default receiver - logs only
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://n8n:5678/webhook/alerts'
        send_resolved: true
        max_alerts: 10

  # Critical alerts receiver
  - name: 'critical-receiver'
    webhook_configs:
      - url: 'http://n8n:5678/webhook/alerts-critical'
        send_resolved: true
        max_alerts: 5
    # Email configuration (uncomment when configured)
    # email_configs:
    #   - to: 'admin@immoguinee.com'
    #     send_resolved: true
    #     headers:
    #       Subject: '[CRITICAL] ImmoGuinee Alert: {{ .GroupLabels.alertname }}'

  # Warning alerts receiver
  - name: 'warning-receiver'
    webhook_configs:
      - url: 'http://n8n:5678/webhook/alerts-warning'
        send_resolved: true
        max_alerts: 10

# Inhibition rules - prevent duplicate alerts
inhibit_rules:
  # If critical alert is firing, inhibit warnings for same alertname
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

  # If PostgreSQL is down, don't alert on connection issues
  - source_match:
      alertname: 'PostgresqlDown'
    target_match_re:
      alertname: 'Postgresql.*'
    equal: ['job']

  # If Redis is down, don't alert on memory/connection issues
  - source_match:
      alertname: 'RedisDown'
    target_match_re:
      alertname: 'Redis.*'
    equal: ['job']

# Templates for notifications
templates:
  - '/etc/alertmanager/templates/*.tmpl'
